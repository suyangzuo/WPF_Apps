<Window
    x:Class="WPF_Typing.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:WPF_Typing"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:wc="clr-namespace:System.Windows.Shell;assembly=PresentationFramework"
    Title="打字练习"
    Width="800"
    Height="600"
    MinWidth="1000"
    MinHeight="600"
    AllowsTransparency="True"
    Background="Transparent"
    FontFamily="{DynamicResource AppFontFamily}"
    Foreground="#FFFFFF"
    WindowStartupLocation="CenterScreen"
    WindowStyle="None"
    mc:Ignorable="d">

    <Window.Resources>
        <!--  进度转弧形转换器  -->
        <local:ProgressToArcConverter x:Key="ProgressToArcConverter" />
        <!--  数字部分转换器  -->
        <local:NumberPartConverter x:Key="NumberPartConverter" />

        <!--  Window drop shadow used for custom chrome window  -->
        <DropShadowEffect
            x:Key="WindowDropShadow"
            BlurRadius="0"
            Opacity="0"
            RenderingBias="Quality"
            ShadowDepth="0"
            Color="#000000" />

        <SolidColorBrush x:Key="WindowBackgroundBrush" Color="#1A1A1A" />
        <SolidColorBrush x:Key="WindowTextBrush" Color="#FFFFFF" />

        <!--  Menu horizontal inner padding (left,right)  -->
        <Thickness x:Key="MenuInnerPadding">8, 0</Thickness>

        <!--  菜单栏背景色  -->
        <SolidColorBrush x:Key="MenuBackgroundBrush" Color="#1A1A1A" />

        <!--  Menu-only font family (force Microsoft YaHei)  -->
        <FontFamily x:Key="MenuFontFamily">Google Sans Code, Consolas, HarmonyOS Sans SC, 微软雅黑</FontFamily>

        <!--  Shared application font family (kept for other controls if needed)  -->
        <FontFamily x:Key="AppFontFamily">Google Sans Code, Consolas, HarmonyOS Sans SC, 微软雅黑</FontFamily>

        <Style TargetType="TextBlock">
            <Setter Property="FontFamily" Value="{StaticResource AppFontFamily}" />
        </Style>

        <Style x:Key="WindowButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border
                            x:Name="Border"
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Stretch"
                            Background="Transparent">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#555" />
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#777" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="CloseButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border
                            x:Name="Border"
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Stretch"
                            Background="Transparent"
                            CornerRadius="0,10,0,0">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#E81123" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!--  播放按钮样式（绿色）  -->
        <Style x:Key="PlayButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#228D42" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border
                            x:Name="Border"
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Stretch"
                            Background="{TemplateBinding Background}"
                            CornerRadius="5">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background">
                                    <Setter.Value>
                                        <SolidColorBrush Color="#329D52" />
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Border" Property="Background">
                                    <Setter.Value>
                                        <SolidColorBrush Color="#1A7A32" />
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!--  停止按钮样式（红色）  -->
        <Style x:Key="StopButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#8C142C" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border
                            x:Name="Border"
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Stretch"
                            Background="{TemplateBinding Background}"
                            CornerRadius="5">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background">
                                    <Setter.Value>
                                        <SolidColorBrush Color="#BD101C" />
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Border" Property="Background">
                                    <Setter.Value>
                                        <SolidColorBrush Color="#B01030" />
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="DarkMenuItemStyle" TargetType="MenuItem">
            <Setter Property="Background" Value="#1A1A1A" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Height" Value="32" />
            <!--  force menu font family  -->
            <Setter Property="FontFamily" Value="{StaticResource MenuFontFamily}" />
            <!--  一级菜单字体大小（只影响顶层菜单项）  -->
            <Setter Property="FontSize" Value="14" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="MenuItem">
                        <Border
                            x:Name="Border"
                            Height="30"
                            Background="#1A1A1A"
                            BorderBrush="Transparent"
                            BorderThickness="1">
                            <Grid>
                                <ContentPresenter
                                    x:Name="HeaderHost"
                                    Margin="12,0"
                                    VerticalAlignment="Center"
                                    ContentSource="Header" />
                                <Popup
                                    x:Name="SubMenuPopup"
                                    AllowsTransparency="True"
                                    HorizontalOffset="-4"
                                    IsOpen="{TemplateBinding IsSubmenuOpen}"
                                    Placement="Bottom"
                                    VerticalOffset="6">
                                    <!--  Keep a single outer border for the submenu panel with rounded corners  -->
                                    <Border
                                        x:Name="SubMenuBorder"
                                        Padding="4"
                                        Background="#2D2D2D"
                                        BorderBrush="Transparent"
                                        BorderThickness="0"
                                        CornerRadius="4">
                                        <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Cycle" />
                                    </Border>
                                </Popup>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#135" />
                                <Setter TargetName="Border" Property="BorderBrush" Value="#2DB" />
                                <Setter TargetName="Border" Property="BorderThickness" Value="1" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!--  Submenu items: remove per-item borders so parent SubMenuBorder provides the overall border  -->
        <Style x:Key="DarkSubMenuItemStyle" TargetType="MenuItem">
            <Setter Property="Background" Value="#2D2D2D" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Height" Value="30" />
            <Setter Property="FontFamily" Value="{StaticResource MenuFontFamily}" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="MenuItem">
                        <Border
                            x:Name="Border"
                            Height="30"
                            Background="{TemplateBinding Background}"
                            BorderBrush="Transparent"
                            BorderThickness="0">
                            <Grid>
                                <ContentPresenter
                                    x:Name="HeaderHost"
                                    Margin="8,0"
                                    VerticalAlignment="Center"
                                    ContentSource="Header" />
                                <Popup
                                    x:Name="SubMenuPopup"
                                    AllowsTransparency="True"
                                    HorizontalOffset="8"
                                    IsOpen="{TemplateBinding IsSubmenuOpen}"
                                    Placement="Right"
                                    VerticalOffset="-4">
                                    <!--  For nested submenus keep their own panel border with rounded corners  -->
                                    <Border
                                        x:Name="SubMenuBorder"
                                        Padding="8"
                                        Background="#2D2D2D"
                                        BorderBrush="#2D2D2D"
                                        BorderThickness="1"
                                        CornerRadius="6">
                                        <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Cycle" />
                                    </Border>
                                </Popup>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#395579" />
                                <!--  do not show per-item border on highlight  -->
                                <Setter TargetName="Border" Property="BorderBrush" Value="Transparent" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!--  Checkable submenu items: also remove per-item borders  -->
        <Style x:Key="RandomMenuItemStyle" TargetType="MenuItem">
            <Setter Property="Background" Value="#2D2D2D" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Height" Value="30" />
            <Setter Property="FontFamily" Value="{StaticResource MenuFontFamily}" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="MenuItem">
                        <Border
                            x:Name="Border"
                            Height="30"
                            Background="#2D2D2D"
                            BorderBrush="Transparent"
                            BorderThickness="0">
                            <Grid>
                                <ContentPresenter
                                    x:Name="HeaderHost"
                                    Margin="8,0"
                                    VerticalAlignment="Center"
                                    ContentSource="Header" />
                                <Popup
                                    x:Name="SubMenuPopup"
                                    AllowsTransparency="True"
                                    HorizontalOffset="8"
                                    IsOpen="{TemplateBinding IsSubmenuOpen}"
                                    Placement="Right"
                                    VerticalOffset="-4">
                                    <Border
                                        x:Name="SubMenuBorder"
                                        Padding="4"
                                        Background="#2D2D2D"
                                        BorderBrush="#2D2D2D"
                                        BorderThickness="1"
                                        CornerRadius="6">
                                        <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Cycle" />
                                    </Border>
                                </Popup>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#395579" />
                                <Setter TargetName="Border" Property="BorderBrush" Value="Transparent" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="CheckableSubMenuItemStyle" TargetType="MenuItem">
            <Setter Property="Background" Value="#2D2D2D" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Height" Value="30" />
            <Setter Property="FontFamily" Value="{StaticResource MenuFontFamily}" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="MenuItem">
                        <Border
                            x:Name="Border"
                            Height="30"
                            Background="#2D2D2D"
                            BorderBrush="Transparent"
                            BorderThickness="0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <Border
                                    x:Name="CheckMarkBox"
                                    Grid.Column="0"
                                    Width="14"
                                    Height="14"
                                    Margin="10,0,0,0"
                                    VerticalAlignment="Center"
                                    Background="Transparent"
                                    BorderBrush="Gray"
                                    BorderThickness="1">
                                    <TextBlock
                                        x:Name="CheckMark"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        FontSize="10"
                                        Foreground="White"
                                        Text="✓"
                                        Visibility="Collapsed" />
                                </Border>
                                <ContentPresenter
                                    x:Name="HeaderHost"
                                    Grid.Column="1"
                                    Margin="10,0"
                                    VerticalAlignment="Center"
                                    ContentSource="Header" />
                                <Popup
                                    x:Name="SubMenuPopup"
                                    AllowsTransparency="True"
                                    HorizontalOffset="8"
                                    IsOpen="{TemplateBinding IsSubmenuOpen}"
                                    Placement="Right"
                                    VerticalOffset="-4">
                                    <Border
                                        x:Name="SubMenuBorder"
                                        Padding="4"
                                        Background="#2D2D2D"
                                        BorderBrush="#2D2D2D"
                                        BorderThickness="1"
                                        CornerRadius="6">
                                        <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Cycle" />
                                    </Border>
                                </Popup>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#345" />
                                <Setter TargetName="Border" Property="BorderBrush" Value="Transparent" />
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="CheckMark" Property="Visibility" Value="Visible" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SubMenuHeaderStyle" TargetType="MenuItem">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Height" Value="30" />
            <Setter Property="FontFamily" Value="{StaticResource MenuFontFamily}" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="MenuItem">
                        <Border
                            x:Name="Border"
                            Height="30"
                            Background="{TemplateBinding Background}"
                            BorderBrush="Transparent"
                            BorderThickness="0">
                            <Grid>
                                <ContentPresenter
                                    x:Name="HeaderHost"
                                    Margin="10,0"
                                    VerticalAlignment="Center"
                                    ContentSource="Header" />
                                <Popup
                                    x:Name="SubMenuPopup"
                                    AllowsTransparency="True"
                                    HorizontalOffset="8"
                                    IsOpen="{TemplateBinding IsSubmenuOpen}"
                                    Placement="Right">
                                    <Border
                                        x:Name="SubMenuBorder"
                                        Padding="4"
                                        Background="#2D2D2D"
                                        BorderBrush="#2D2D2D"
                                        BorderThickness="1"
                                        CornerRadius="6">
                                        <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Cycle" />
                                    </Border>
                                </Popup>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <!--  match hover background of other second-level menu items but keep no outer border  -->
                                <Setter TargetName="Border" Property="Background" Value="#395579" />
                                <Setter TargetName="Border" Property="BorderBrush" Value="Transparent" />
                                <Setter TargetName="Border" Property="BorderThickness" Value="0" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <WindowChrome.WindowChrome>
        <WindowChrome
            CaptionHeight="0"
            CornerRadius="10"
            GlassFrameThickness="0"
            ResizeBorderThickness="5"
            UseAeroCaptionButtons="False" />
    </WindowChrome.WindowChrome>

    <Border
        Background="#1A1A1A"
        BorderBrush="#555"
        BorderThickness="1"
        CornerRadius="10"
        Effect="{StaticResource WindowDropShadow}">
        <Grid>
            <Grid
                x:Name="TitleBarGrid"
                Height="36"
                VerticalAlignment="Top"
                Panel.ZIndex="10"
                MouseLeftButtonDown="WindowTitleBar_MouseLeftButtonDown"
                MouseLeftButtonUp="WindowTitleBar_MouseLeftButtonUp"
                MouseMove="WindowTitleBar_MouseMove">
                <Border Background="#2D2D2D" CornerRadius="10,10,0,0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <Image
                            Grid.Column="0"
                            Width="20"
                            Height="20"
                            Margin="8,0,8,0"
                            VerticalAlignment="Center"
                            SnapsToDevicePixels="True"
                            Source="pack://siteoforigin:,,,/Assets/Images/PNG/十指禅.png"
                            Stretch="Uniform" />

                        <!--  左侧标题"十指禅"  -->
                        <TextBlock
                            x:Name="AppTitleText"
                            Grid.Column="1"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Center"
                            Margin="0,0,0,0"
                            FontSize="14"
                            Foreground="#CCC"
                            IsHitTestVisible="False"
                            Text="十指禅" />

                        <!--  Buttons remain in right column  -->
                        <StackPanel
                            Grid.Column="2"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Top"
                            Panel.ZIndex="10"
                            Orientation="Horizontal">
                            <Button
                                x:Name="MinimizeButton"
                                Width="45"
                                Height="36"
                                Click="MinimizeButton_Click"
                                Content="–"
                                Focusable="True"
                                FontSize="16"
                                Style="{StaticResource WindowButtonStyle}" />
                            <Button
                                x:Name="MaximizeButton"
                                Width="45"
                                Height="36"
                                Click="MaximizeButton_Click"
                                Content="▢"
                                Focusable="True"
                                FontSize="16"
                                Style="{StaticResource WindowButtonStyle}" />
                            <Button
                                x:Name="CloseButton"
                                Width="45"
                                Height="36"
                                Click="CloseButton_Click"
                                Content="✕"
                                Focusable="True"
                                FontSize="16"
                                Style="{StaticResource CloseButtonStyle}" />
                        </StackPanel>

                        <!--  居中显示文章信息：文件夹名 - 文章名称  -->
                        <TextBlock
                            x:Name="ArticleInfoText"
                            Grid.Column="0"
                            Grid.ColumnSpan="3"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Panel.ZIndex="20"
                            FontSize="14"
                            Foreground="#CCC"
                            IsHitTestVisible="False"
                            Text="" />
                    </Grid>
                </Border>
            </Grid>

            <Menu
                Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Window}}"
                Height="32"
                Margin="0,38,0,0"
                Padding="{StaticResource MenuInnerPadding}"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Top"
                Panel.ZIndex="0"
                Background="{StaticResource MenuBackgroundBrush}"
                BorderBrush="#10FFFFFF"
                BorderThickness="0,0,0,1"
                FontFamily="{StaticResource MenuFontFamily}"
                Foreground="White">
                <MenuItem Header="文件" Style="{StaticResource DarkMenuItemStyle}">
                    <MenuItem Click="OpenMenuItem_Click" Style="{StaticResource DarkSubMenuItemStyle}">
                        <MenuItem.Header>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock
                                    Margin="0,0,8,0"
                                    VerticalAlignment="Center"
                                    FontSize="16"
                                    Foreground="#4D8BCF"
                                    Text="📂" />
                                <TextBlock VerticalAlignment="Center" Text="打开" />
                            </StackPanel>
                        </MenuItem.Header>
                    </MenuItem>
                    <MenuItem Click="ExitMenuItem_Click" Style="{StaticResource DarkSubMenuItemStyle}">
                        <MenuItem.Header>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock
                                    Margin="0,0,8,0"
                                    VerticalAlignment="Center"
                                    FontSize="16"
                                    Foreground="#FFA500"
                                    Text="🚪" />
                                <TextBlock VerticalAlignment="Center" Text="退出" />
                            </StackPanel>
                        </MenuItem.Header>
                    </MenuItem>
                </MenuItem>
                <MenuItem Header="设置" Style="{StaticResource DarkMenuItemStyle}">
                    <MenuItem Click="NameMenuItem_Click" Style="{StaticResource DarkSubMenuItemStyle}">
                        <MenuItem.Header>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock
                                    Margin="0,0,8,0"
                                    VerticalAlignment="Center"
                                    FontSize="16"
                                    Foreground="#4169E1"
                                    Text="👤" />
                                <TextBlock VerticalAlignment="Center" Text="姓名" />
                            </StackPanel>
                        </MenuItem.Header>
                    </MenuItem>
                    <MenuItem Click="TimingMenuItem_Click" Style="{StaticResource DarkSubMenuItemStyle}">
                        <MenuItem.Header>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock
                                    Margin="0,0,8,0"
                                    VerticalAlignment="Center"
                                    FontSize="16"
                                    Foreground="#00CED1"
                                    Text="⏱️" />
                                <TextBlock VerticalAlignment="Center" Text="计时" />
                            </StackPanel>
                        </MenuItem.Header>
                    </MenuItem>
                    <MenuItem Click="AnalysisMenuItem_Click" Style="{StaticResource DarkSubMenuItemStyle}">
                        <MenuItem.Header>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock
                                    Margin="0,0,8,0"
                                    VerticalAlignment="Center"
                                    FontSize="16"
                                    Foreground="#32CD32"
                                    Text="📊" />
                                <TextBlock VerticalAlignment="Center" Text="统计" />
                            </StackPanel>
                        </MenuItem.Header>
                    </MenuItem>
                    <MenuItem
                        x:Name="RandomMenuItem"
                        Click="RandomMenuItem_Click"
                        IsCheckable="True"
                        IsChecked="False"
                        Style="{StaticResource RandomMenuItemStyle}">
                        <MenuItem.Header>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock
                                    x:Name="RandomEmoji"
                                    Margin="0,0,8,0"
                                    VerticalAlignment="Center"
                                    FontSize="16"
                                    Foreground="#BBB"
                                    Text="🔲"
                                    Opacity="1" />
                                <TextBlock VerticalAlignment="Center" Text="随机" />
                            </StackPanel>
                        </MenuItem.Header>
                    </MenuItem>
                </MenuItem>
                <MenuItem
                    x:Name="TextSelectionMenu"
                    Header="文本选择"
                    Style="{StaticResource DarkMenuItemStyle}">
                    <!--  动态填充  -->
                    <MenuItem
                        Header="(加载中...)"
                        IsEnabled="False"
                        Style="{StaticResource DarkSubMenuItemStyle}" />
                </MenuItem>
                <MenuItem Header="帮助" Style="{StaticResource DarkMenuItemStyle}">
                    <MenuItem Click="HelpMenuItem_Click" Style="{StaticResource DarkSubMenuItemStyle}">
                        <MenuItem.Header>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock
                                    Margin="0,0,8,0"
                                    VerticalAlignment="Center"
                                    FontSize="16"
                                    Foreground="#FFD700"
                                    Text="❓" />
                                <TextBlock VerticalAlignment="Center" Text="使用说明" />
                            </StackPanel>
                        </MenuItem.Header>
                    </MenuItem>
                    <MenuItem Click="AboutMenuItem_Click" Style="{StaticResource DarkSubMenuItemStyle}">
                        <MenuItem.Header>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock
                                    Margin="0,0,8,0"
                                    VerticalAlignment="Center"
                                    FontSize="16"
                                    Foreground="#87CEEB"
                                    Text="ℹ️" />
                                <TextBlock VerticalAlignment="Center" Text="关于" />
                            </StackPanel>
                        </MenuItem.Header>
                    </MenuItem>
                </MenuItem>
            </Menu>

            <Grid Margin="0,84,0,0">
                <!--  主内容区: 占位, 用户后续扩展内容  -->
                <!--  播放/停止按钮 (右上角)  -->
                <Button
                    x:Name="PlayStopButton"
                    Width="30"
                    Height="30"
                    Margin="0,85,60,0"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Panel.ZIndex="30"
                    Click="PlayStopButton_Click"
                    Focusable="False"
                    FontSize="16"
                    Style="{StaticResource PlayButtonStyle}">
                    ▶
                </Button>

                <Border
                    Margin="50,75,50,25"
                    Padding="50,0,50,0"
                    Background="#151515"
                    BorderThickness="2"
                    ClipToBounds="True"
                    CornerRadius="8">
                    <!--  Typing area: RichTextBox used to render per-character Runs so we can color them  -->
                    <!--  使用 ScrollViewer 包裹 RichTextBox，完全控制滚动行为  -->
                    <ScrollViewer
                        x:Name="TypingDisplayScrollViewer"
                        HorizontalScrollBarVisibility="Disabled"
                        VerticalScrollBarVisibility="Hidden">
                        <RichTextBox
                            x:Name="TypingDisplay"
                            Height="Auto"
                            MaxWidth="1250"
                            HorizontalAlignment="Stretch"
                            AcceptsReturn="False"
                            AcceptsTab="False"
                            Background="#151515"
                            BorderThickness="0"
                            FontFamily="{StaticResource MenuFontFamily}"
                            FontSize="24"
                            Foreground="#777"
                            HorizontalScrollBarVisibility="Disabled"
                            IsDocumentEnabled="True"
                            IsReadOnly="True"
                            PreviewKeyDown="TypingDisplay_PreviewKeyDown"
                            PreviewTextInput="TypingDisplay_PreviewTextInput"
                            SnapsToDevicePixels="True"
                            TextOptions.TextFormattingMode="Display"
                            UseLayoutRounding="True">
                            <FlowDocument>
                                <Paragraph />
                            </FlowDocument>
                        </RichTextBox>
                    </ScrollViewer>
                </Border>

                <StackPanel
                    Width="Auto"
                    MaxWidth="1000"
                    Margin="25,5,25,0"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Top"
                    Panel.ZIndex="20"
                    IsHitTestVisible="False">
                    <!--  Tester name in top-right of main content area (below title/menu)  -->
                    <Grid
                        x:Name="TopRightInfoPanel"
                        Width="Auto"
                        MaxWidth="1000"
                        Margin="0,0,0,0"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Center">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <!--  1) 已输入字符数 / 总字符数 (label + numbers; label 和数字用不同颜色)  -->
                        <TextBlock
                            Grid.Column="0"
                            Width="{local:TextWidth Text='已输入:9999/9999', FontSize=14, Padding=10}"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            FontFamily="{StaticResource MenuFontFamily}"
                            FontSize="1"
                            TextAlignment="Left">
                            <Run
                                FontSize="14"
                                Foreground="DarkGray"
                                Text="已输入" />
                            <Run
                                FontFamily="{StaticResource MenuFontFamily}"
                                FontSize="14"
                                Foreground="DimGray"
                                Text=":&#8202;" />
                            <Run
                                FontSize="14"
                                Foreground="#9DCBFF"
                                Text="{Binding TypedCount, Mode=OneWay, FallbackValue=0}" />
                            <Run
                                FontFamily="微软雅黑"
                                FontSize="14"
                                Foreground="Gray"
                                Text="&#8202;/&#8202;" />
                            <Run
                                FontSize="14"
                                Foreground="LightBlue"
                                Text="{Binding TotalCount, Mode=OneWay, FallbackValue=0}" />
                        </TextBlock>

                        <!--  2) 输入进度: (标签 + 圆形进度条)  -->
                        <StackPanel
                            Grid.Column="1"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Orientation="Horizontal">
                            <TextBlock
                                VerticalAlignment="Center"
                                FontFamily="{StaticResource MenuFontFamily}"
                                FontSize="14"
                                Foreground="DarkGray"
                                LineHeight="14">
                                <Run Text="进度" />
                                <InlineUIContainer BaselineAlignment="Baseline">
                                    <TextBlock
                                        Margin="-6,0,0,0"
                                        FontFamily="{StaticResource MenuFontFamily}"
                                        FontSize="14"
                                        Foreground="DimGray"
                                        Text=":&#8202;" />
                                </InlineUIContainer>
                            </TextBlock>
                            <!--  Outer: 圆形进度条容器  -->
                            <Grid
                                Width="60"
                                Height="60"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                ClipToBounds="False">
                                <!--  Outer: 圆形边框  -->
                                <Ellipse
                                    Width="56"
                                    Height="56"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Fill="Transparent"
                                    Stroke="#234"
                                    StrokeThickness="2" />
                                <!--  Outer: 进度渐变（使用Path绘制弧形）  -->
                                <Path
                                    Width="60"
                                    Height="60"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Data="{Binding ProgressPercent, Converter={StaticResource ProgressToArcConverter}, Mode=OneWay}"
                                    Stroke="DarkSeaGreen"
                                    StrokeEndLineCap="Round"
                                    StrokeStartLineCap="Round"
                                    StrokeThickness="2"
                                    Stretch="None" />
                                <!--  Inner: 内圆（半径小5，即直径小10）  -->
                                <Ellipse
                                    Width="46"
                                    Height="46"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Fill="#1A1A1A" />
                                <!--  Inner: 文本内容（整数部分右对齐，靠近小数点）  -->
                                <Grid
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock
                                        Grid.Column="0"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Center"
                                        FontFamily="{StaticResource MenuFontFamily}"
                                        FontSize="11"
                                        Foreground="#FFA500"
                                        Text="{Binding ProgressPercent, Converter={StaticResource NumberPartConverter}, ConverterParameter=Integer, Mode=OneWay, FallbackValue=0}" />
                                    <TextBlock
                                        Grid.Column="1"
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Center"
                                        FontFamily="{StaticResource MenuFontFamily}"
                                        FontSize="11"
                                        Foreground="#89A"
                                        Text="{Binding ProgressPercent, Converter={StaticResource NumberPartConverter}, ConverterParameter=Dot, Mode=OneWay, FallbackValue=''}" />
                                    <TextBlock
                                        Grid.Column="2"
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Center"
                                        FontFamily="{StaticResource MenuFontFamily}"
                                        FontSize="11"
                                        Foreground="#FFA500"
                                        Text="{Binding ProgressPercent, Converter={StaticResource NumberPartConverter}, ConverterParameter=DecimalOnly, Mode=OneWay, FallbackValue=''}" />
                                    <TextBlock
                                        Grid.Column="3"
                                        Margin="2,0,0,0"
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Center"
                                        FontFamily="Google Sans Code, Consolas, HarmonyOS Sans SC, 微软雅黑"
                                        FontSize="11"
                                        Foreground="LightSlateGray"
                                        Text="%" />
                                </Grid>
                            </Grid>
                        </StackPanel>

                        <!--  3) 正确率: (标签 + 只显示百分比)  -->
                        <TextBlock
                            Grid.Column="2"
                            Width="{local:TextWidth Text='正确率：99.99%', FontSize=14, Padding=10}"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            FontFamily="{StaticResource MenuFontFamily}"
                            FontSize="1"
                            TextAlignment="Left">
                            <Run
                                FontSize="14"
                                Foreground="DarkGray"
                                Text="正确率" />
                            <Run
                                FontFamily="{StaticResource MenuFontFamily}"
                                FontSize="14"
                                Foreground="DimGray"
                                Text=":&#8202;" />
                            <Run
                                FontSize="14"
                                Foreground="#FFD700"
                                Text="{Binding AccuracyPercent, Converter={StaticResource NumberPartConverter}, ConverterParameter=Integer, Mode=OneWay, FallbackValue=0}" />
                            <Run
                                FontSize="14"
                                Foreground="#89A"
                                Text="{Binding AccuracyPercent, Converter={StaticResource NumberPartConverter}, ConverterParameter=Dot, Mode=OneWay, FallbackValue=''}" />
                            <Run
                                FontSize="14"
                                Foreground="#FFD700"
                                Text="{Binding AccuracyPercent, Converter={StaticResource NumberPartConverter}, ConverterParameter=DecimalOnly, Mode=OneWay, FallbackValue=''}" />
                            <Run
                                FontFamily="HarmonyOS Sans SC, 微软雅黑"
                                FontSize="12"
                                Foreground="LightSlateGray"
                                Text="&#8202;%" />
                        </TextBlock>

                        <!--  4) 速度: 显示数字并带单位 (数字与单位用不同颜色)  -->
                        <TextBlock
                            Grid.Column="3"
                            Width="{local:TextWidth Text='速度:9999', FontSize=14, Padding=10}"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            FontFamily="{StaticResource MenuFontFamily}"
                            FontSize="1"
                            TextAlignment="Left">
                            <Run
                                FontSize="14"
                                Foreground="DarkGray"
                                Text="速度" />
                            <Run
                                FontFamily="{StaticResource MenuFontFamily}"
                                FontSize="14"
                                Foreground="DimGray"
                                Text=":&#8202;" />
                            <Run
                                FontSize="14"
                                Foreground="GreenYellow"
                                Text="{Binding Speed, Mode=OneWay, FallbackValue=0, StringFormat={}{0:F0}}" />
                        </TextBlock>

                        <!--  5) 已用时间: 时:分:秒 (numbers and colons different colors)  -->
                        <TextBlock
                            Grid.Column="4"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            FontFamily="{StaticResource MenuFontFamily}"
                            FontSize="1">
                            <Run
                                FontSize="14"
                                Foreground="DarkGray"
                                Text="用时" />
                            <Run
                                FontFamily="{StaticResource MenuFontFamily}"
                                FontSize="14"
                                Foreground="DimGray"
                                Text=":&#8202;" />
                            <Run
                                FontSize="14"
                                Foreground="#9DCBFF"
                                Text="{Binding ElapsedHours, Mode=OneWay, FallbackValue=0, StringFormat={}{0:D2}}" />
                            <Run
                                FontFamily="{StaticResource MenuFontFamily}"
                                FontSize="14"
                                Foreground="DimGray"
                                Text=":" />
                            <Run
                                FontSize="14"
                                Foreground="#9DCBFF"
                                Text="{Binding ElapsedMinutes, Mode=OneWay, FallbackValue=0, StringFormat={}{0:D2}}" />
                            <Run
                                FontFamily="{StaticResource MenuFontFamily}"
                                FontSize="14"
                                Foreground="DimGray"
                                Text=":" />
                            <Run
                                FontSize="14"
                                Foreground="#9DCBFF"
                                Text="{Binding ElapsedSeconds, Mode=OneWay, FallbackValue=0, StringFormat={}{0:D2}}" />
                        </TextBlock>

                        <!--  6) 测试者姓名 (existing binding preserved)  -->
                        <TextBlock
                            Grid.Column="5"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            FontFamily="{StaticResource MenuFontFamily}"
                            FontSize="1">
                            <Run
                                FontSize="14"
                                Foreground="DarkGray"
                                Text="姓名" />
                            <Run
                                FontFamily="{StaticResource MenuFontFamily}"
                                FontSize="14"
                                Foreground="DimGray"
                                Text=":&#8202;" />
                            <Run FontSize="14" Foreground="#4D8BCF">
                                <Run.Text>
                                    <Binding
                                        FallbackValue="江湖人士"
                                        Mode="OneWay"
                                        Path="TesterName"
                                        TargetNullValue="江湖人士" />
                                </Run.Text>
                            </Run>
                        </TextBlock>
                    </Grid>
                </StackPanel>
            </Grid>
        </Grid>
    </Border>
</Window>
