<Window
  x:Class="WPF_Typing.MainWindow"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:local="clr-namespace:WPF_Typing"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:wc="clr-namespace:System.Windows.Shell;assembly=PresentationFramework"
  Title="打字练习"
  Width="800"
  Height="450"
  MinWidth="600"
  MinHeight="400"
  AllowsTransparency="True"
  Background="Transparent"
  FontFamily="{DynamicResource AppFontFamily}"
  Foreground="#FFFFFF"
  WindowStartupLocation="CenterScreen"
  WindowStyle="None"
  mc:Ignorable="d">

  <Window.Resources>
    <SolidColorBrush x:Key="WindowBackgroundBrush" Color="#1A1A1A" />
    <SolidColorBrush x:Key="WindowTextBrush" Color="#FFFFFF" />

    <!--  Menu horizontal inner padding (left,right)  -->
    <Thickness x:Key="MenuInnerPadding">8, 0</Thickness>

    <!--  菜单栏背景色  -->
    <SolidColorBrush x:Key="MenuBackgroundBrush" Color="#1A1A1A" />

    <!--  Menu-only font family (force Microsoft YaHei)  -->
    <FontFamily x:Key="MenuFontFamily">/WPF_Typing;component/Assets/Fonts/#Google Sans Code, Consolas, HarmonyOS Sans SC, 微软雅黑</FontFamily>

    <!--  Shared application font family (kept for other controls if needed)  -->
    <FontFamily x:Key="AppFontFamily">/WPF_Typing;component/Assets/Fonts/#Google Sans Code, Consolas, HarmonyOS Sans SC, 微软雅黑</FontFamily>

    <Style TargetType="TextBlock">
      <Setter Property="FontFamily" Value="{StaticResource AppFontFamily}" />
    </Style>

    <Style x:Key="WindowButtonStyle" TargetType="Button">
      <Setter Property="Background" Value="Transparent" />
      <Setter Property="Foreground" Value="White" />
      <Setter Property="BorderThickness" Value="0" />
      <Setter Property="Cursor" Value="Hand" />
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="Button">
            <Border
              x:Name="Border"
              HorizontalAlignment="Stretch"
              VerticalAlignment="Stretch"
              Background="Transparent">
              <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
            </Border>
            <ControlTemplate.Triggers>
              <Trigger Property="IsMouseOver" Value="True">
                <Setter TargetName="Border" Property="Background" Value="#555" />
              </Trigger>
              <Trigger Property="IsPressed" Value="True">
                <Setter TargetName="Border" Property="Background" Value="#777" />
              </Trigger>
            </ControlTemplate.Triggers>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
    </Style>

    <Style x:Key="CloseButtonStyle" TargetType="Button">
      <Setter Property="Background" Value="Transparent" />
      <Setter Property="Foreground" Value="White" />
      <Setter Property="BorderThickness" Value="0" />
      <Setter Property="Cursor" Value="Hand" />
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="Button">
            <Border
              x:Name="Border"
              HorizontalAlignment="Stretch"
              VerticalAlignment="Stretch"
              Background="Transparent"
              CornerRadius="0,10,0,0">
              <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
            </Border>
            <ControlTemplate.Triggers>
              <Trigger Property="IsMouseOver" Value="True">
                <Setter TargetName="Border" Property="Background" Value="#E81123" />
              </Trigger>
            </ControlTemplate.Triggers>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
    </Style>

    <Style x:Key="DarkMenuItemStyle" TargetType="MenuItem">
      <Setter Property="Background" Value="#1A1A1A" />
      <Setter Property="Foreground" Value="White" />
      <Setter Property="BorderThickness" Value="0" />
      <Setter Property="Height" Value="32" />
      <!--  force menu font family  -->
      <Setter Property="FontFamily" Value="{StaticResource MenuFontFamily}" />
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="MenuItem">
            <Border
              x:Name="Border"
              Height="30"
              Background="#1A1A1A"
              BorderBrush="Transparent"
              BorderThickness="1">
              <Grid>
                <ContentPresenter
                  x:Name="HeaderHost"
                  Margin="10,0"
                  VerticalAlignment="Center"
                  ContentSource="Header" />
                <Popup
                  x:Name="SubMenuPopup"
                  AllowsTransparency="True"
                  HorizontalOffset="-2"
                  IsOpen="{TemplateBinding IsSubmenuOpen}"
                  Placement="Bottom"
                  VerticalOffset="5">
                  <!--  Keep a single outer border for the submenu panel with rounded corners  -->
                  <Border
                    x:Name="SubMenuBorder"
                    Padding="4"
                    Background="#2D2D2D"
                    BorderBrush="Transparent"
                    BorderThickness="0"
                    CornerRadius="4">
                    <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Cycle" />
                  </Border>
                </Popup>
              </Grid>
            </Border>
            <ControlTemplate.Triggers>
              <Trigger Property="IsHighlighted" Value="True">
                <Setter TargetName="Border" Property="Background" Value="#135" />
                <Setter TargetName="Border" Property="BorderBrush" Value="#2DB" />
                <Setter TargetName="Border" Property="BorderThickness" Value="1" />
              </Trigger>
            </ControlTemplate.Triggers>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
    </Style>

    <!--  Submenu items: remove per-item borders so parent SubMenuBorder provides the overall border  -->
    <Style x:Key="DarkSubMenuItemStyle" TargetType="MenuItem">
      <Setter Property="Background" Value="#2D2D2D" />
      <Setter Property="Foreground" Value="White" />
      <Setter Property="BorderThickness" Value="0" />
      <Setter Property="Height" Value="30" />
      <Setter Property="FontFamily" Value="{StaticResource MenuFontFamily}" />
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="MenuItem">
            <Border
              x:Name="Border"
              Height="30"
              Background="#2D2D2D"
              BorderBrush="Transparent"
              BorderThickness="0">
              <Grid>
                <ContentPresenter
                  x:Name="HeaderHost"
                  Margin="20,0"
                  VerticalAlignment="Center"
                  ContentSource="Header" />
                <Popup
                  x:Name="SubMenuPopup"
                  AllowsTransparency="True"
                  HorizontalOffset="8"
                  IsOpen="{TemplateBinding IsSubmenuOpen}"
                  Placement="Right">
                  <!--  For nested submenus keep their own panel border with rounded corners  -->
                  <Border
                    x:Name="SubMenuBorder"
                    Background="#2D2D2D"
                    BorderBrush="#2D2D2D"
                    BorderThickness="1"
                    CornerRadius="6">
                    <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Cycle" />
                  </Border>
                </Popup>
              </Grid>
            </Border>
            <ControlTemplate.Triggers>
              <Trigger Property="IsHighlighted" Value="True">
                <Setter TargetName="Border" Property="Background" Value="#259" />
                <!--  do not show per-item border on highlight  -->
                <Setter TargetName="Border" Property="BorderBrush" Value="Transparent" />
              </Trigger>
            </ControlTemplate.Triggers>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
    </Style>

    <!--  Checkable submenu items: also remove per-item borders  -->
    <Style x:Key="CheckableSubMenuItemStyle" TargetType="MenuItem">
      <Setter Property="Background" Value="#2D2D2D" />
      <Setter Property="Foreground" Value="White" />
      <Setter Property="BorderThickness" Value="0" />
      <Setter Property="Height" Value="30" />
      <Setter Property="FontFamily" Value="{StaticResource MenuFontFamily}" />
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="MenuItem">
            <Border
              x:Name="Border"
              Height="30"
              Background="#2D2D2D"
              BorderBrush="Transparent"
              BorderThickness="0">
              <Grid>
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="Auto" />
                  <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Border
                  x:Name="CheckMarkBox"
                  Grid.Column="0"
                  Width="14"
                  Height="14"
                  Margin="10,0,0,0"
                  VerticalAlignment="Center"
                  Background="Transparent"
                  BorderBrush="Gray"
                  BorderThickness="1">
                  <TextBlock
                    x:Name="CheckMark"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    FontSize="10"
                    Foreground="White"
                    Text="✓"
                    Visibility="Collapsed" />
                </Border>
                <ContentPresenter
                  x:Name="HeaderHost"
                  Grid.Column="1"
                  Margin="10,0"
                  VerticalAlignment="Center"
                  ContentSource="Header" />
                <Popup
                  x:Name="SubMenuPopup"
                  AllowsTransparency="True"
                  HorizontalOffset="8"
                  IsOpen="{TemplateBinding IsSubmenuOpen}"
                  Placement="Right">
                  <Border
                    x:Name="SubMenuBorder"
                    Background="#2D2D2D"
                    BorderBrush="#2D2D2D"
                    BorderThickness="1"
                    CornerRadius="6">
                    <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Cycle" />
                  </Border>
                </Popup>
              </Grid>
            </Border>
            <ControlTemplate.Triggers>
              <Trigger Property="IsHighlighted" Value="True">
                <Setter TargetName="Border" Property="Background" Value="#345" />
                <Setter TargetName="Border" Property="BorderBrush" Value="Transparent" />
              </Trigger>
              <Trigger Property="IsChecked" Value="True">
                <Setter TargetName="CheckMark" Property="Visibility" Value="Visible" />
              </Trigger>
            </ControlTemplate.Triggers>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
    </Style>

    <Style x:Key="SubMenuHeaderStyle" TargetType="MenuItem">
      <Setter Property="Background" Value="Transparent" />
      <Setter Property="Foreground" Value="White" />
      <Setter Property="BorderThickness" Value="0" />
      <Setter Property="Height" Value="30" />
      <Setter Property="FontFamily" Value="{StaticResource MenuFontFamily}" />
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="MenuItem">
            <Border
              x:Name="Border"
              Height="30"
              Background="Transparent"
              BorderBrush="Transparent"
              BorderThickness="0">
              <Grid>
                <ContentPresenter
                  x:Name="HeaderHost"
                  Margin="10,0"
                  VerticalAlignment="Center"
                  ContentSource="Header" />
                <Popup
                  x:Name="SubMenuPopup"
                  AllowsTransparency="True"
                  HorizontalOffset="8"
                  IsOpen="{TemplateBinding IsSubmenuOpen}"
                  Placement="Right">
                  <Border
                    x:Name="SubMenuBorder"
                    Background="#2D2D2D"
                    BorderBrush="#2D2D2D"
                    BorderThickness="1"
                    CornerRadius="6">
                    <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Cycle" />
                  </Border>
                </Popup>
              </Grid>
            </Border>
            <ControlTemplate.Triggers>
              <Trigger Property="IsHighlighted" Value="True">
                <!--  match hover background of other second-level menu items but keep no outer border  -->
                <Setter TargetName="Border" Property="Background" Value="#259" />
                <Setter TargetName="Border" Property="BorderBrush" Value="Transparent" />
                <Setter TargetName="Border" Property="BorderThickness" Value="0" />
              </Trigger>
            </ControlTemplate.Triggers>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
    </Style>
  </Window.Resources>

  <WindowChrome.WindowChrome>
    <WindowChrome
      CaptionHeight="0"
      CornerRadius="10"
      GlassFrameThickness="0"
      ResizeBorderThickness="5"
      UseAeroCaptionButtons="False" />
  </WindowChrome.WindowChrome>

  <Border
    Background="#1A1A1A"
    BorderBrush="#555"
    BorderThickness="1"
    CornerRadius="10">
    <Grid>
      <Grid
        x:Name="TitleBarGrid"
        Height="36"
        VerticalAlignment="Top"
        Panel.ZIndex="10"
        MouseLeftButtonDown="WindowTitleBar_MouseLeftButtonDown">
        <Border Background="#2D2D2D" CornerRadius="10,10,0,0">
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="Auto" />
              <ColumnDefinition Width="*" />
              <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <Image
              Grid.Column="0"
              Width="20"
              Height="20"
              Margin="8,0,8,0"
              VerticalAlignment="Center"
              SnapsToDevicePixels="True"
              Source="pack://siteoforigin:,,,/Assets/Images/PNG/十指禅.png"
              Stretch="Uniform" />

            <!--  Buttons remain in right column  -->
            <StackPanel
              Grid.Column="2"
              HorizontalAlignment="Right"
              VerticalAlignment="Top"
              Panel.ZIndex="10"
              Orientation="Horizontal">
              <Button
                x:Name="MinimizeButton"
                Width="45"
                Height="36"
                Click="MinimizeButton_Click"
                Content="–"
                Focusable="True"
                FontSize="16"
                Style="{StaticResource WindowButtonStyle}" />
              <Button
                x:Name="MaximizeButton"
                Width="45"
                Height="36"
                Click="MaximizeButton_Click"
                Content="▢"
                Focusable="True"
                FontSize="16"
                Style="{StaticResource WindowButtonStyle}" />
              <Button
                x:Name="CloseButton"
                Width="45"
                Height="36"
                Click="CloseButton_Click"
                Content="✕"
                Focusable="True"
                FontSize="16"
                Style="{StaticResource CloseButtonStyle}" />
            </StackPanel>

            <!--  overlayed centered title so it's visually centered for the whole title bar  -->
            <TextBlock
              x:Name="TitleText"
              Grid.Column="0"
              Grid.ColumnSpan="3"
              HorizontalAlignment="Center"
              VerticalAlignment="Center"
              Panel.ZIndex="20"
              FontSize="14"
              Foreground="#CCC"
              IsHitTestVisible="False"
              Text="十指禅" />
          </Grid>
        </Border>
      </Grid>

      <Menu
        Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Window}}"
        Height="32"
        Margin="0,38,0,0"
        Padding="{StaticResource MenuInnerPadding}"
        HorizontalAlignment="Stretch"
        VerticalAlignment="Top"
        Panel.ZIndex="10"
        Background="{StaticResource MenuBackgroundBrush}"
        FontFamily="{StaticResource MenuFontFamily}"
        Foreground="White">
        <MenuItem Header="文件" Style="{StaticResource DarkMenuItemStyle}">
          <MenuItem
            Click="ExitMenuItem_Click"
            Header="退出"
            Style="{StaticResource DarkSubMenuItemStyle}" />
        </MenuItem>
        <MenuItem Header="设置" Style="{StaticResource DarkMenuItemStyle}">
          <MenuItem
            Click="TimingMenuItem_Click"
            Header="计时"
            Style="{StaticResource DarkSubMenuItemStyle}" />
          <MenuItem
            Click="NameMenuItem_Click"
            Header="姓名"
            Style="{StaticResource DarkSubMenuItemStyle}" />
          <MenuItem
            Click="AnalysisMenuItem_Click"
            Header="分析"
            Style="{StaticResource DarkSubMenuItemStyle}" />
        </MenuItem>
        <MenuItem
          x:Name="TextSelectionMenu"
          Header="文本选择"
          Style="{StaticResource DarkMenuItemStyle}">
          <!--  动态填充  -->
          <MenuItem
            Header="(加载中...)"
            IsEnabled="False"
            Style="{StaticResource DarkSubMenuItemStyle}" />
        </MenuItem>
        <MenuItem Header="帮助" Style="{StaticResource DarkMenuItemStyle}">
          <MenuItem
            Click="HelpMenuItem_Click"
            Header="使用说明"
            Style="{StaticResource DarkSubMenuItemStyle}" />
          <MenuItem
            Click="AboutMenuItem_Click"
            Header="关于"
            Style="{StaticResource DarkSubMenuItemStyle}" />
        </MenuItem>
      </Menu>

      <Grid Margin="0,84,0,0">
        <!--  主内容区: 占位, 用户后续扩展内容  -->
        <Border
          Margin="20"
          Background="#151515"
          BorderBrush="#333"
          BorderThickness="1"
          CornerRadius="6">
          <TextBlock
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            Foreground="#DDD"
            Text="在这里显示打字练习界面 (未实现)" />
        </Border>
      </Grid>
    </Grid>
  </Border>
</Window>
